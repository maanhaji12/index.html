<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>حاسبة السعرات والبروتين</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    body {
      font-family: 'Arial', sans-serif;
      background-color: #23384a;
      color: white;
      direction: rtl;
      padding: 20px;
    }
    h1 {
      text-align: center;
      color: #ff4d4d;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input, select {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      border-radius: 5px;
      border: none;
    }
    button {
      margin-top: 20px;
      width: 100%;
      background-color: #ff4d4d;
      color: white;
      padding: 10px;
      border: none;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    .results {
      margin-top: 20px;
      padding: 15px;
      background-color: #2d4a5f;
      border-radius: 10px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    table, th, td {
      border: 1px solid #ffffff44;
    }
    th, td {
      padding: 8px;
      text-align: center;
    }
    th {
      background-color: #ff4d4d;
    }
  </style>
</head>
<body>

  <h1>حاسبة السعرات والبروتين</h1>

  <label for="gender">الجنس:</label>
  <select id="gender">
    <option value="male">ذكر</option>
    <option value="female">أنثى</option>
  </select>

  <label for="age">العمر (بالسنوات):</label>
  <input type="number" id="age">

  <label for="weight">الوزن (كغ):</label>
  <input type="number" id="weight">

  <label for="height">الطول (سم):</label>
  <input type="number" id="height">

  <label for="activity">مستوى النشاط:</label>
  <select id="activity">
    <option value="1.2">قليل أو بدون نشاط</option>
    <option value="1.375">نشاط خفيف (1-3 أيام/أسبوع)</option>
    <option value="1.55">نشاط متوسط (3-5 أيام/أسبوع)</option>
    <option value="1.725">نشاط عالي (6-7 أيام/أسبوع)</option>
    <option value="1.9">نشاط رياضي مكثف</option>
  </select>

  <button onclick="calculate()">احسب</button>
  <button onclick="downloadPDF()">📄 تحميل البرنامج كملف PDF</button>

  <div class="results" id="results" style="display: none;"></div>

  <script>
    function generateMonthPlan(mealPlan) {
      let table = '<h3>📅 برنامج الأكل لمدة شهر:</h3>';
      table += '<table><tr><th>اليوم</th><th>الفطور</th><th>سناك 1</th><th>الغداء</th><th>سناك 2</th><th>العشاء</th></tr>';
      for (let i = 1; i <= 30; i++) {
        table += `<tr><td>اليوم ${i}</td><td>${mealPlan.breakfast}</td><td>${mealPlan.snack1}</td><td>${mealPlan.lunch}</td><td>${mealPlan.snack2}</td><td>${mealPlan.dinner}</td></tr>`;
      }
      table += '</table>';
      return table;
    }

    function calculate() {
      const gender = document.getElementById("gender").value;
      const age = parseInt(document.getElementById("age").value);
      const weight = parseFloat(document.getElementById("weight").value);
      const height = parseFloat(document.getElementById("height").value);
      const activity = parseFloat(document.getElementById("activity").value);

      if (!age || !weight || !height) {
        alert("يرجى تعبئة جميع الحقول");
        return;
      }

      let bmr;
      if (gender === "male") {
        bmr = 10 * weight + 6.25 * height - 5 * age + 5;
      } else {
        bmr = 10 * weight + 6.25 * height - 5 * age - 161;
      }

      const calories = bmr * activity;
      const protein = weight * 1.6;

      const bmi = weight / Math.pow(height / 100, 2);
      const idealWeight = 22 * Math.pow(height / 100, 2);
      const weightDiff = idealWeight - weight;
      let weeksNeeded = Math.abs(weightDiff) / 0.5;

      let recommendation = "";
      let plan = "";
      let mealPlan = {};

      if (bmi < 18.5) {
        recommendation = `✅ وزنك أقل من الطبيعي. الوزن المثالي هو ${idealWeight.toFixed(1)} كغ. تحتاج لزيادة ${(weightDiff).toFixed(1)} كغ خلال تقريبًا ${Math.ceil(weeksNeeded)} أسبوع.`;
        plan = `🍽️ نظام زيادة الوزن:<ul><li>تناول ${Math.round(calories + 300)} سعرة يوميًا</li><li>ركز على البروتين: ${(weight * 1.8).toFixed(1)} غرام يوميًا</li><li>قسم الوجبات إلى 5 يوميًا، أضف المكسرات والحليب الكامل الدسم</li></ul>`;
        mealPlan = {
          breakfast: 'بيضتان + خبز + جبنة + حليب كامل',
          snack1: 'تمر + زبدة فول سوداني',
          lunch: 'دجاج أو لحم + أرز + سلطة',
          snack2: 'مكسرات + موزة',
          dinner: 'بطاطا + تونة + خضار مشوية'
        };
      } else if (bmi >= 25) {
        recommendation = `⚠️ وزنك زائد. الوزن المثالي هو ${idealWeight.toFixed(1)} كغ. تحتاج لإنقاص ${(Math.abs(weightDiff)).toFixed(1)} كغ خلال تقريبًا ${Math.ceil(weeksNeeded)} أسبوع.`;
        plan = `🍏 نظام إنقاص الوزن:<ul><li>تناول ${Math.round(calories - 500)} سعرة يوميًا</li><li>البروتين المستهدف: ${(weight * 2).toFixed(1)} غرام يوميًا</li><li>قلل الكربوهيدرات والسكريات، مارس الرياضة 4-5 مرات أسبوعيًا</li></ul>`;
        mealPlan = {
          breakfast: 'شوفان + موزة + حليب قليل الدسم',
          snack1: 'خيار + لوز',
          lunch: 'صدر دجاج مشوي + أرز بني + خضار',
          snack2: 'زبادي يوناني',
          dinner: 'شوربة عدس + سلطة'
        };
      } else {
        recommendation = `✅ وزنك مثالي. حافظ على تناول ${Math.round(calories)} سعرة حرارية و${protein.toFixed(1)} غرام بروتين.`;
        plan = `<ul><li>نظامك جيد! استمر على نفس الروتين وراقب وزنك شهريًا.</li></ul>`;
        mealPlan = {
          breakfast: 'بيضتين + خضار + خبز أسمر',
          snack1: 'تفاحة + حفنة مكسرات',
          lunch: 'سمك مشوي + بطاطا + سلطة',
          snack2: 'لبن + تمرتين',
          dinner: 'فول + طماطم + زيت زيتون'
        };
      }

      const monthPlan = generateMonthPlan(mealPlan);

      document.getElementById("results").style.display = "block";
      document.getElementById("results").innerHTML =
        `<p>🔥 السعرات اليومية المطلوبة: <strong>${Math.round(calories)} سعرة حرارية</strong></p>
         <p>💪 كمية البروتين اليومية: <strong>${protein.toFixed(1)} غرام</strong></p>
         <p>📊 الوزن المثالي: <strong>${idealWeight.toFixed(1)} كغ</strong></p>
         <p>📋 التوصية: ${recommendation}</p>
         <p>${plan}</p>
         ${monthPlan}`;
    }

    function downloadPDF() {
      const element = document.getElementById("results");
      html2canvas(element, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jspdf.jsPDF("p", "mm", "a4");
        const pageHeight = pdf.internal.pageSize.height;
        let imgHeight = (canvas.height * 210) / canvas.width;
        let heightLeft = imgHeight;
        let position = 0;

        pdf.addImage(imgData, "PNG", 0, position, 210, imgHeight);
        heightLeft -= pageHeight;

        while (heightLeft > 0) {
          position = heightLeft - imgHeight;
          pdf.addPage();
          pdf.addImage(imgData, "PNG", 0, position, 210, imgHeight);
          heightLeft -= pageHeight;
        }

        pdf.save("برنامج-غذائي-شهري.pdf");
      });
    }
  </script>

</body>
</html>
